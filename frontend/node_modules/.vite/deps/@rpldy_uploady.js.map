{
  "version": 3,
  "sources": ["../../@rpldy/uploady/lib/esm/Uploady.js", "../../@rpldy/uploady/lib/esm/useFileInput.js", "../../@rpldy/uploady/lib/esm/index.js"],
  "sourcesContent": ["function _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport React, { forwardRef, memo, useRef } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { invariant, hasWindow } from \"@rpldy/shared\";\nimport { NoDomUploady, useUploadOptions } from \"@rpldy/shared-ui\";\nconst NO_CONTAINER_ERROR_MSG = \"Uploady - Container for file input must be a valid dom element\";\nconst renderInput = (inputProps, instanceOptions, ref) => /*#__PURE__*/React.createElement(\"input\", _extends({}, inputProps, {\n  name: instanceOptions.inputFieldName,\n  type: \"file\",\n  ref: ref\n}));\nconst renderInPortal = (container, isValidContainer, inputProps, instanceOptions, ref) => container && isValidContainer ? /*#__PURE__*/ReactDOM.createPortal(renderInput(inputProps, instanceOptions, ref), container) : null;\nconst FileInputField = /*#__PURE__*/memo(/*#__PURE__*/forwardRef(({\n  container,\n  noPortal,\n  ...inputProps\n}, ref) => {\n  const instanceOptions = useUploadOptions();\n  const isValidContainer = container && container.nodeType === 1;\n  invariant(isValidContainer || !hasWindow(), NO_CONTAINER_ERROR_MSG);\n  return noPortal ? renderInput(inputProps, instanceOptions, ref) : renderInPortal(container, isValidContainer, inputProps, instanceOptions, ref);\n}));\nconst Uploady = props => {\n  const {\n    multiple = true,\n    capture,\n    accept,\n    webkitdirectory,\n    children,\n    inputFieldContainer,\n    customInput,\n    fileInputId,\n    noPortal = false,\n    ...noDomProps\n  } = props;\n  const container = !customInput ? inputFieldContainer || (hasWindow() ? document.body : null) : null;\n  const internalInputFieldRef = useRef();\n  return /*#__PURE__*/React.createElement(NoDomUploady, _extends({}, noDomProps, {\n    inputRef: internalInputFieldRef\n  }), !customInput ? /*#__PURE__*/React.createElement(FileInputField, {\n    container: container,\n    multiple: multiple,\n    capture: capture,\n    accept: accept,\n    webkitdirectory: webkitdirectory?.toString(),\n    style: {\n      display: \"none\"\n    },\n    ref: internalInputFieldRef,\n    id: fileInputId,\n    noPortal: noPortal\n  }) : null, children);\n};\nexport default Uploady;", "import { useEffect } from \"react\";\nimport { logger } from \"@rpldy/shared\";\nimport { useUploadyContext } from \"@rpldy/shared-ui\";\nconst getUrl = form => {\n  const loc = window.location;\n  let url = form.getAttribute(\"action\") || \"\";\n  url = url.replace(/\\s/g, \"\");\n  let path;\n  switch (true) {\n    case url === \"\":\n      url = loc.href;\n      break;\n    case url.startsWith(\"/\"):\n      url = `${loc.protocol}//${loc.host}${url}`;\n      break;\n    case !/:\\/\\//.test(url):\n      path = loc.pathname.split(\"/\").slice(0, -1).concat(\"\").join(\"/\");\n      url = `${loc.protocol}//${loc.host}${path}${url}`;\n      break;\n  }\n  return url;\n};\nconst getNewDestination = (input, form) => {\n  const method = form?.getAttribute(\"method\"),\n    url = form && getUrl(form);\n  return {\n    filesParamName: input.getAttribute(\"name\"),\n    method: method ? method.toUpperCase() : undefined,\n    url: url\n  };\n};\nconst retrieveDestinationFromInput = (input, onUpdate) => {\n  let destination, stopObserving;\n  const form = input.closest(\"form\");\n  if (form) {\n    destination = getNewDestination(input, form);\n    logger.debugLog(`Uploady.useFileInput: using custom input's parent form url ${destination.url || \"\"} and method ${destination.method || \"\"}`);\n    let observer = new MutationObserver(records => {\n      if (records[0]?.attributeName === \"action\") {\n        const newDestination = getNewDestination(input, form);\n        if (newDestination.url) {\n          logger.debugLog(`Uploady.useFileInput: form action attribute changed to ${newDestination.url}`);\n          onUpdate(newDestination);\n        }\n      }\n    });\n    observer?.observe(form, {\n      attributes: true,\n      attributeFilter: [\"action\"]\n    });\n    stopObserving = () => {\n      observer?.disconnect();\n      observer = null;\n    };\n  }\n  onUpdate(destination || getNewDestination(input));\n  return {\n    stopObserving\n  };\n};\nconst useFileInput = fileInputRef => {\n  const context = useUploadyContext();\n  if (fileInputRef) {\n    context.setExternalFileInput(fileInputRef);\n  }\n  useEffect(() => {\n    let stopObservingCallback;\n    if (fileInputRef?.current && \"closest\" in fileInputRef.current) {\n      const input = fileInputRef.current;\n      const uploaderOptions = context.getOptions();\n      if (!uploaderOptions.destination || !uploaderOptions.destination.url) {\n        const {\n          stopObserving\n        } = retrieveDestinationFromInput(input, newDestination => {\n          context.setOptions({\n            destination: newDestination\n          });\n        });\n        stopObservingCallback = stopObserving;\n      }\n    }\n    return () => {\n      stopObservingCallback?.();\n    };\n  }, [fileInputRef, context]);\n  return !!fileInputRef ? fileInputRef : context.getInternalFileInput();\n};\nexport default useFileInput;", "import Uploady from \"./Uploady\";\nexport default Uploady;\nexport { default as useFileInput } from \"./useFileInput\";\nexport { Uploady };\nexport * from \"@rpldy/uploader\";\nexport * from \"@rpldy/shared-ui\";"],
  "mappings": "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",
  "names": ["React", "ReactDOM", "invariant", "import_react"]
}
